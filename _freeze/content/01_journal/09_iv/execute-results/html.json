{
  "hash": "8de04279609f8baf65d2faa55fd7d209",
  "result": {
    "markdown": "---\ntitle: \"Instrumental Variables\"\n---\n\n\n\n# Load packages\n\n::: {.cell hash='09_iv_cache/html/unnamed-chunk-1_d3bd5c5283d7c92a5c3f2e0bb721e362'}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(dagitty)\nlibrary(ggdag)\nlibrary(MatchIt)\nlibrary(estimatr)\n```\n:::\n\n\n# Load data\n\n::: {.cell hash='09_iv_cache/html/unnamed-chunk-2_b99ab0ce86cb3e0c348f82db70b9c7ca'}\n\n```{.r .cell-code}\nsetwd(\"D:/CausalDataScience/cdsba-LukasB2324/content/01_journal\")\nrand_enc_data<-readRDS(\"Data/rand_enc.rds\")\n```\n:::\n\n\n\n# Assignment 1\n\n::: {.cell hash='09_iv_cache/html/unnamed-chunk-3_37681a9064e6b511106f1242adaad7fa'}\n\n```{.r .cell-code}\nrand_enc_DAG <- dagify(\n  Y ~ D,\n  Y ~ U,\n  D ~ U,\n  D ~ Z,\n  exposure = \"D\",\n  latent = \"U\",\n  outcome = \"Y\",\n  coords = list(x = c(U = 1, D = 0, Y = 2, Z = -1),\n                y = c(U = 1, D = 0, Y = 0, Z = 0)),\n  labels = c(\"D\" = \"Used new feature\", \n             \"Y\" = \"Time spent\", \n             \"U\" = \"Unknown confounders\",\n             \"Z\" = \"Popup\")\n)\nggdag(rand_enc_DAG, text = T) +\n  guides(color = \"none\") + \n  #geom_dag_point(color = ggthemr::swatch()[2]) +\n  geom_dag_text(color = \"white\") +\n  geom_dag_edges(edge_color = \"black\") +\n  geom_dag_label_repel(aes(label = label)) +\n  theme_dag_blank()\n```\n\n::: {.cell-output-display}\n![](09_iv_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n\n# Assignment 2\n\n::: {.cell hash='09_iv_cache/html/unnamed-chunk-4_4678b90892c5f19d0bb8409a62cc1b29'}\n\n```{.r .cell-code}\nlm_2<-lm(time_spent~used_ftr,rand_enc_data)\nsummary(lm_2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> lm(formula = time_spent ~ used_ftr, data = rand_enc_data)\n#> \n#> Residuals:\n#>      Min       1Q   Median       3Q      Max \n#> -20.4950  -3.5393   0.0158   3.5961  20.5051 \n#> \n#> Coefficients:\n#>             Estimate Std. Error t value Pr(>|t|)    \n#> (Intercept) 18.86993    0.06955   271.3   <2e-16 ***\n#> used_ftr    10.82269    0.10888    99.4   <2e-16 ***\n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> Residual standard error: 5.351 on 9998 degrees of freedom\n#> Multiple R-squared:  0.497,\tAdjusted R-squared:  0.497 \n#> F-statistic:  9881 on 1 and 9998 DF,  p-value: < 2.2e-16\n```\n:::\n\n```{.r .cell-code}\nsprintf(\"The naive estimate of the effect of the new feature is about %.2f.\",lm_2[[\"coefficients\"]][[\"used_ftr\"]])\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [1] \"The naive estimate of the effect of the new feature is about 10.82.\"\n```\n:::\n:::\n\n\n\n# Assignment 3\n\n::: {.cell hash='09_iv_cache/html/unnamed-chunk-5_5338db1dd45dfe04008fd70457fce02a'}\n\n```{.r .cell-code}\ncor_matrix <- cor(rand_enc_data) %>% round(2)\ncor_matrix\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#>            rand_enc used_ftr time_spent\n#> rand_enc       1.00     0.20       0.13\n#> used_ftr       0.20     1.00       0.71\n#> time_spent     0.13     0.71       1.00\n```\n:::\n\n```{.r .cell-code}\nplot_instrument_treat <- ggplot(rand_enc_data[,c(1,2)], aes(x = rand_enc, y = used_ftr)) +\n  geom_point(alpha = .8) +\n  stat_smooth(method = \"lm\", se = F)\nplot_treat_outcome <- ggplot(rand_enc_data[,c(2,3)], aes(x = used_ftr, y = time_spent)) +\n  geom_point(alpha = .8) +\n  stat_smooth(method = \"lm\", se = F)\nplot_instrument_outcome <- ggplot(rand_enc_data[,c(1,3)], aes(x = rand_enc, y = time_spent)) +\n  geom_point(alpha = .8) +\n  stat_smooth(method = \"lm\", se = F)\nplot_instrument_treat\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> `geom_smooth()` using formula = 'y ~ x'\n```\n:::\n\n::: {.cell-output-display}\n![](09_iv_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n\n```{.r .cell-code}\nplot_treat_outcome\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> `geom_smooth()` using formula = 'y ~ x'\n```\n:::\n\n::: {.cell-output-display}\n![](09_iv_files/figure-html/unnamed-chunk-5-2.png){width=672}\n:::\n\n```{.r .cell-code}\nplot_instrument_outcome\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> `geom_smooth()` using formula = 'y ~ x'\n```\n:::\n\n::: {.cell-output-display}\n![](09_iv_files/figure-html/unnamed-chunk-5-3.png){width=672}\n:::\n\n```{.r .cell-code}\nsprintf(\"The plots show that the effect of the instrument on the treatment and on the outcome goes in the same direction (prerequisite 5 fullfilled). There is a correlation between the instrument 'rand_enc' and the treatment 'used_ftr', so the 4th prerequisite is fullfilled, altough the correlation is rather low (about %.2f). There is also a small correlation between the instrument 'rand_enc' and the outcome 'time_spent' of about %.2f. The correlation between the instrument and the treatment is only a little higher (%.2f) than the correlation between the treatment and the outcome, so the combination of treatment and instrument is not very suiting and the instrumental variable estimation is not a very adequate procedure in the given case.\", cor_matrix[1,2],cor_matrix[1,3],  cor_matrix[1,2]-cor_matrix[1,3])\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [1] \"The plots show that the effect of the instrument on the treatment and on the outcome goes in the same direction (prerequisite 5 fullfilled). There is a correlation between the instrument 'rand_enc' and the treatment 'used_ftr', so the 4th prerequisite is fullfilled, altough the correlation is rather low (about 0.20). There is also a small correlation between the instrument 'rand_enc' and the outcome 'time_spent' of about 0.13. The correlation between the instrument and the treatment is only a little higher (0.07) than the correlation between the treatment and the outcome, so the combination of treatment and instrument is not very suiting and the instrumental variable estimation is not a very adequate procedure in the given case.\"\n```\n:::\n:::\n\n\n\n# Assignement 4\n\n::: {.cell hash='09_iv_cache/html/unnamed-chunk-6_68bfd16f033b1d4e199263f5d227f47c'}\n\n```{.r .cell-code}\niv_estimate<-iv_robust(time_spent~used_ftr|rand_enc, rand_enc_data)\nsummary(iv_estimate)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> iv_robust(formula = time_spent ~ used_ftr | rand_enc, data = rand_enc_data)\n#> \n#> Standard error type:  HC2 \n#> \n#> Coefficients:\n#>             Estimate Std. Error t value  Pr(>|t|) CI Lower CI Upper   DF\n#> (Intercept)   19.312     0.2248   85.89 0.000e+00   18.872    19.75 9998\n#> used_ftr       9.738     0.5353   18.19 8.716e-73    8.689    10.79 9998\n#> \n#> Multiple R-squared:  0.4921 ,\tAdjusted R-squared:  0.492 \n#> F-statistic:   331 on 1 and 9998 DF,  p-value: < 2.2e-16\n```\n:::\n\n```{.r .cell-code}\nsprintf(\"The naive estimate (%.2f) has an upward bias compared to the instrumental variable estimate (%.2f). Though the validity of the instrumental variable estimate can also be questioned (see Assignment 3).\", lm_2[[\"coefficients\"]][[\"used_ftr\"]], iv_estimate[[\"coefficients\"]][[\"used_ftr\"]])\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [1] \"The naive estimate (10.82) has an upward bias compared to the instrumental variable estimate (9.74). Though the validity of the instrumental variable estimate can also be questioned (see Assignment 3).\"\n```\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\r\n<script src=\"../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}